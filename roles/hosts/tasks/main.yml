---
#
# This task sets up /etc/hosts on a machine.
#
# This should only be used in rare cases
#

#
# This will move a /etc/hosts in place if it's setup in files for that host/domain
# Note that if it's not set it will just skip this play and do nothing.
#
- name: setup /etc/hosts for some clients
  vars:
    hosts_candidates_static:
      - "{{ inventory_hostname }}-hosts"
      - "{{ ansible_hostname }}-hosts"
      - "{{ host_group }}-hosts"
      - "{{ ansible_domain }}-hosts"
      - "{{ datacenter }}-hosts"
  copy: src={{ item }} dest=/etc/hosts
  with_first_found: >-
    {{
      if (vpn | default(false)) and (datacenter | default('iad2')) != 'iad2'
      (hosts_candidates_static + ["vpn"])
      else
      (hosts_candidates_static + ["base"])
    }}
  tags:
  - config
  - hosts

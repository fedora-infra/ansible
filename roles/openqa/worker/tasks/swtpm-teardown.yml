- name: Stop and disable swtpm services
  service: name=openqa-swtpm@{{ item }} enabled=no state=stopped
  loop: "{{ range(1, openqa_workers + 1)|list }}"
  when: "deployment_type is defined and deployment_type == 'prod'"

- name: Remove openqa-swtpm service file
  file: path=/etc/systemd/system/openqa-swtpm@.service state=absent

- name: Unload custom SELinux policy
  command: semodule -r systemd-swtpm

- name: Remove custom SELinux policy file
  file: path=/usr/local/share/selinux/systemd-swtpm.pp state=absent

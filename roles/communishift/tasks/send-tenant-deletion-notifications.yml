---
- name: Send Communishift Project Cleanup notifications emails to tenants
  community.general.mail:
    host: localhost
    port: 25
    subject: "Fedora Communishift Notification: {{ item.value.name }}"
    body: "This is a reminder that the Communishift project {{ item.value.name }} will be deleted during the Fedora post release process. Please ensure you have a backup of any important configuration or data from your project."
    from: admin@fedoraproject.org
    to:
      - D Kirwan <dkirwan+communishift_notification_test_1@redhat.com>
      - David K <dkirwan+communishift_notification_test_2@redhat.com>
    cc: David Kirwan <dkirwan@redhat.com>
    headers:
      - Reply-To=admin@fedoraproject.org
    charset: us-ascii
  delegate_to: localhost
  when: "{{ not item.value.do_not_delete | bool }}"
  tags:
    - communishift_send_notifications
    - never # Only send notifications when the tag communishift_send_notifications is passed


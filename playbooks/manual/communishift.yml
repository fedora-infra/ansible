---
- hosts: localhost
  user: root
  gather_facts: false

  vars_files:
    - /srv/web/infra/ansible/vars/global.yml
    - "/srv/private/ansible/vars.yml"
    - /srv/web/infra/ansible/vars/{{ ansible_distribution }}.yml

  tasks:
    - name: Communishift Role
      include_role:
        name: communishift
        tasks_from: administration-tasks
        apply:
          tags:
            - deploy-operators
    - name: Communishift Role
      with_items: "{{ communishift_projects }}"
      include_role:
        name: communishift
        tasks_from: main
        apply:
          tags:
            - create_efs
      vars:
        communishift_project_name: "{{ outer_item }}"
      loop_control:
        loop_var: outer_item
  vars:
    communishift_projects:
      - communishift-dev-test
      - communishift-mattdm
